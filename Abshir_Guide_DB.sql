-- 1. تهيئة قاعدة البيانات (لضمان عدم وجود بيانات قديمة)
DROP DATABASE IF EXISTS Abshir_Guide_DB;
CREATE DATABASE Abshir_Guide_DB;
USE Abshir_Guide_DB;

-- 2. أوامر إنشاء الجداول السبعة
CREATE TABLE Entities (
    entity_id INT PRIMARY KEY AUTO_INCREMENT,
    entity_name VARCHAR(100) NOT NULL UNIQUE,
    entity_url VARCHAR(255) NOT NULL
);
CREATE TABLE Services (
    service_id INT PRIMARY KEY AUTO_INCREMENT,
    entity_id INT NOT NULL,
    service_name VARCHAR(200) NOT NULL,
    FOREIGN KEY (entity_id) REFERENCES Entities(entity_id)
);
CREATE TABLE Steps (
    step_id INT PRIMARY KEY AUTO_INCREMENT,
    service_id INT NOT NULL,
    step_order INT NOT NULL,
    step_description TEXT NOT NULL,
    FOREIGN KEY (service_id) REFERENCES Services(service_id),
    UNIQUE (service_id, step_order)
);
CREATE TABLE Requirement_Definition (
    req_def_id INT PRIMARY KEY AUTO_INCREMENT,
    req_unique_name VARCHAR(100) NOT NULL UNIQUE,
    req_display_name_ar VARCHAR(100) NOT NULL,
    source_type ENUM('ABSHER', 'USER_INPUT', 'UPLOAD_FILE') NOT NULL,
    data_type ENUM('STRING', 'INT', 'DATE', 'BOOLEAN', 'FILE', 'ADDRESS') NOT NULL
);
CREATE TABLE Service_Requirements (
    service_req_id INT PRIMARY KEY AUTO_INCREMENT,
    step_id INT NOT NULL,
    req_def_id INT NOT NULL,
    is_required BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (step_id) REFERENCES Steps(step_id),
    FOREIGN KEY (req_def_id) REFERENCES Requirement_Definition(req_def_id),
    UNIQUE (step_id, req_def_id)
);
CREATE TABLE Complex_Journeys (
    journey_id INT PRIMARY KEY AUTO_INCREMENT,
    journey_name VARCHAR(200) NOT NULL UNIQUE,
    search_keyword VARCHAR(100) NOT NULL UNIQUE
);
CREATE TABLE Journey_Services (
    journey_service_id INT PRIMARY KEY AUTO_INCREMENT,
    journey_id INT NOT NULL,
    service_id INT NOT NULL,
    service_order INT NOT NULL,
    FOREIGN KEY (journey_id) REFERENCES Complex_Journeys(journey_id),
    FOREIGN KEY (service_id) REFERENCES Services(service_id),
    UNIQUE (journey_id, service_id)
);


-- 3. إدخال بيانات: تعريف المتطلبات (Requirement_Definition) 
INSERT INTO Requirement_Definition (req_def_id, req_unique_name, req_display_name_ar, source_type, data_type) VALUES
(1001, 'National_ID', 'رقم الهوية الوطنية', 'ABSHER', 'INT'), (1002, 'Land_Area', 'مساحة الأرض بالمتر المربع', 'USER_INPUT', 'INT'),
(1003, 'Land_Ownership_Proof', 'صك ملكية الأرض', 'UPLOAD_FILE', 'FILE'), (1004, 'Project_Blueprints', 'المخططات الهندسية المعتمدة', 'UPLOAD_FILE', 'FILE'),
(1005, 'Building_License_ID', 'رقم رخصة البناء', 'ABSHER', 'STRING'), (1006, 'National_Address', 'العنوان الوطني', 'ABSHER', 'ADDRESS'),
(1007, 'Electrical_Load_Data', 'بيانات سعة الأحمال الكهربائية', 'USER_INPUT', 'INT'), (1008, 'Technical_Water_Report', 'تقرير مسار توصيل العدادات', 'UPLOAD_FILE', 'FILE'),
(1009, 'Commercial_Name', 'الاسم التجاري المقترح', 'USER_INPUT', 'STRING'), (1010, 'Capital_Amount', 'رأس مال الشركة', 'USER_INPUT', 'INT'),
(1011, 'Commercial_Registration_Number', 'رقم السجل التجاري (CRN)', 'ABSHER', 'STRING'), (1012, 'Expected_Annual_Revenue', 'الإيرادات السنوية المتوقعة', 'USER_INPUT', 'INT'),
(1013, 'Visa_Number', 'رقم التأشيرة الصادرة', 'ABSHER', 'STRING'), (1014, 'Employment_Contract', 'عقد العمل الموثق', 'UPLOAD_FILE', 'FILE'),
(1015, 'Foreign_Worker_ID', 'رقم هوية العامل (أثناء الإصدار)', 'USER_INPUT', 'STRING'), (1016, 'Health_Insurance_Policy', 'رقم وثيقة التأمين الطبي السارية', 'ABSHER', 'STRING'),
(1017, 'Title_Deed_ID', 'معرف العقار / رقم الصك', 'USER_INPUT', 'STRING'), (1018, 'Payment_Amount', 'المبلغ المدفوع لفك الرهن', 'USER_INPUT', 'INT'),
(1019, 'Mortgage_Release_Waiver', 'وثيقة فك الرهن', 'UPLOAD_FILE', 'FILE'), (1020, 'Buyer_National_ID', 'رقم هوية المشتري', 'USER_INPUT', 'INT'),
(1021, 'Health_Institution_Type', 'نوع المنشأة الصحية (عيادة/مستشفى)', 'USER_INPUT', 'STRING'), (1022, 'Health_Manager_ID', 'هوية المدير الطبي/الفني', 'USER_INPUT', 'INT'),
(1023, 'Academic_Qualification', 'شهادات المؤهل للمسؤولين', 'UPLOAD_FILE', 'FILE'), (1024, 'Safety_Certificate_ID', 'رقم شهادة السلامة', 'ABSHER', 'STRING'),
(1025, 'Fire_System_Report', 'تقارير صيانة أنظمة الإطفاء', 'UPLOAD_FILE', 'FILE'), (1026, 'Vehicle_VIN', 'رقم هيكل المركبة (VIN)', 'USER_INPUT', 'STRING'),
(1027, 'Valid_MVPI_Certificate', 'شهادة الفحص الفني السارية', 'ABSHER', 'BOOLEAN'), (1028, 'National_ID_Buyer', 'رقم هوية المشتري (للتأمين)', 'USER_INPUT', 'INT'),
(1029, 'Payment_Details', 'تفاصيل دفع التأمين', 'USER_INPUT', 'STRING'), (1030, 'Policy_Number', 'رقم وثيقة التأمين الجديدة', 'ABSHER', 'STRING'),
(2001, 'Financial_Statement', 'القوائم المالية للشركة', 'UPLOAD_FILE', 'FILE'), (2002, 'Tax_Clearance_Certificate', 'شهادة سداد الزكاة والضرائب', 'ABSHER', 'BOOLEAN'),
(2003, 'Health_Fitness_Cert', 'شهادة اللياقة الصحية (للقادمين)', 'UPLOAD_FILE', 'FILE'), (2004, 'Passport_Copy', 'صورة من جواز السفر', 'UPLOAD_FILE', 'FILE'),
(2005, 'Traffic_Violation_Receipt', 'سند سداد المخالفات المرورية', 'USER_INPUT', 'STRING'), (2006, 'Vehicle_Plate_Number', 'رقم لوحة المركبة', 'USER_INPUT', 'STRING'),
(2007, 'Commercial_License_ID', 'رقم الرخصة التجارية', 'ABSHER', 'STRING'), (2008, 'Entity_Renewal_Fees', 'رسوم تجديد الرخصة/التسجيل', 'USER_INPUT', 'INT'),
(2009, 'Land_Survey_Report', 'تقرير مساحي للعقار', 'UPLOAD_FILE', 'FILE'), (2010, 'Health_Professional_ID', 'رقم هوية الممارس الصحي', 'ABSHER', 'STRING'),
(2011, 'Construction_Progress_Report', 'تقرير نسبة إنجاز البناء', 'UPLOAD_FILE', 'FILE'), (2012, 'Housing_Support_Terms', 'شروط الأهلية للدعم السكني', 'ABSHER', 'BOOLEAN'),
(2013, 'Meter_Transfer_Request', 'طلب نقل ملكية العدادات', 'USER_INPUT', 'STRING'), (2014, 'Bill_Payment_Receipt', 'سند سداد آخر فاتورة', 'UPLOAD_FILE', 'FILE'),
(2015, 'Temporary_Water_Connection', 'طلب توصيل مؤقت (للمشاريع)', 'USER_INPUT', 'STRING'), (2016, 'Commercial_Activity_Type', 'نوع النشاط التجاري الرئيسي', 'USER_INPUT', 'STRING'),
(2017, 'Family_Members_Count', 'عدد أفراد العائلة (للتأشيرات)', 'USER_INPUT', 'INT'), (2018, 'Loan_Early_Settlement_Offer', 'عرض السداد المبكر للقرض', 'ABSHER', 'STRING'),
(2019, 'Final_Inspection_Request', 'طلب شهادة إتمام البناء', 'USER_INPUT', 'STRING'), (3001, 'Contract_Termination_Proof', 'وثيقة إنهاء العقد', 'UPLOAD_FILE', 'FILE'),
(3002, 'Water_Quality_Report', 'تقرير فحص جودة المياه', 'USER_INPUT', 'STRING'), (3003, 'Entity_Ownership_Change', 'مستند تغيير ملكية المنشأة', 'UPLOAD_FILE', 'FILE'),
(3004, 'Trade_Mark_Registration', 'طلب تسجيل علامة تجارية', 'USER_INPUT', 'STRING'), (3005, 'Traffic_Accident_Report', 'تقرير حادث مروري (نجم/مرور)', 'ABSHER', 'FILE'),
(3006, 'Vehicle_Insurance_Proof', 'وثيقة تأمين المركبة سارية', 'ABSHER', 'BOOLEAN'), (3007, 'Medical_Equipment_List', 'قائمة الأجهزة الطبية المرخصة', 'UPLOAD_FILE', 'FILE'),
(3008, 'Building_Reclassification', 'طلب إعادة تصنيف المبنى', 'USER_INPUT', 'STRING'), (3009, 'Hajj_Permit_Status', 'حالة تصريح الحج', 'ABSHER', 'BOOLEAN'),
(3010, 'Loan_Restructuring_Request', 'طلب إعادة جدولة القرض', 'USER_INPUT', 'STRING'), (3011, 'Complaint_Type', 'نوع الشكوى (ضد شركة التأمين)', 'USER_INPUT', 'STRING'),
(3012, 'Equipment_List', 'قائمة معدات ومركبات السلامة', 'UPLOAD_FILE', 'FILE'), (4001, 'Mortgage_Details', 'تفاصيل الرهن التجاري', 'USER_INPUT', 'STRING'),
(4002, 'Fund_Disbursement_Request', 'طلب صرف الدفعة التمويلية', 'USER_INPUT', 'STRING'), (4003, 'Sponsorship_Transfer_Form', 'نموذج نقل الكفالة', 'UPLOAD_FILE', 'FILE'),
(4004, 'Deceased_ID', 'رقم هوية المتوفى', 'USER_INPUT', 'INT');


-- 4. إدخال بيانات: الجهات الحكومية (Entities) 
INSERT INTO Entities (entity_id, entity_name, entity_url) VALUES
(1, 'بلدي', 'https://balady.gov.sa'), (2, 'سكني', 'https://sakani.sa'), (3, 'الكهرباء', 'https://www.se.com.sa/'),
(4, 'المياه الوطنية', 'https://nwc.com.sa'), (5, 'وزارة التجارة', 'https://mc.gov.sa/ar/pages/default.aspx'), (6, 'قوى (وزارة العمل)', 'https://qiwa.sa'),
(7, 'هيئة الزكاة والضريبة والجمارك (ZATCA)', 'https://zatca.gov.sa'), (8, 'العنوان الوطني (سُبل)', 'https://splonline.com.sa'), (9, 'الداخلية (أبشر)', 'https://absher.sa'),
(10, 'الجوازات', 'https://gdp.gov.sa'), (11, 'مجلس الضمان الصحي/التأمين', 'https://cchi.gov.sa'), (12, 'وزارة العدل (ناجز)', 'https://najiz.sa'),
(13, 'البنك/المُمول العقاري', 'https://sama.gov.sa'), (14, 'الدفاع المدني', 'https://998.gov.sa'), (15, 'المرور (عبر أبشر/تم)', 'https://absher.sa/traffic'),
(16, 'الفحص الدوري (MVPI)', 'https://mvpi.com.sa'), (17, 'وزارة الصحة', 'https://moh.gov.sa');


-- 5. إدخال بيانات: الخدمات البسيطة (Services) - 
INSERT INTO Services (service_id, entity_id, service_name) VALUES
(1, 1, 'رخصة بناء'), (2, 2, 'طلب دعم البناء الذاتي'), (3, 3, 'طلب توصيل خدمة الكهرباء'), (4, 4, 'طلب توصيل خدمات المياه والصرف الصحي'),
(5, 5, 'حجز الاسم التجاري'), (6, 5, 'إصدار السجل التجاري'), (7, 6, 'تسجيل المنشأة في منصة قوى'), (8, 7, 'التسجيل في ضريبة القيمة المضافة (VAT)'),
(9, 8, 'تسجيل العنوان الوطني للمنشأة'), (10, 9, 'إصدار تأشيرة عمل'), (11, 6, 'توثيق عقد العمل'), (12, 11, 'إصدار وثيقة تأمين طبي سارية'),
(13, 10, 'إصدار الإقامة (Roc)'), (14, 13, 'طلب فك الرهن (رهن العقار)'), (15, 12, 'طلب الإفراغ العقاري (نقل الملكية)'), (16, 12, 'تحديث الصكوك العقارية'),
(17, 17, 'ترخيص المنشأة الطبية'), (18, 1, 'إصدار رخصة البناء التشغيلية'), (19, 14, 'إصدار شهادة السلامة (للمبنى)'), (20, 16, 'إجراء الفحص الفني الدوري'),
(21, 11, 'شراء وثيقة تأمين سارٍ'), (22, 15, 'نقل ملكية المركبة إلكترونياً'),
(23, 17, 'تجديد ترخيص الممارس الصحي'), (24, 17, 'تسجيل مولود جديد'), (25, 14, 'تجديد رخصة السلامة للمنشآت'), (26, 14, 'الإبلاغ عن حادث حريق'),
(27, 15, 'تجديد رخصة القيادة'), (28, 15, 'تفويض داخلي لقيادة مركبة'), (29, 7, 'تقديم إقرار ضريبة القيمة المضافة'), (30, 7, 'إصدار شهادة الزكاة'),
(31, 10, 'تجديد إقامة عامل وافد'), (32, 10, 'إصدار/تجديد جواز سفر سعودي'), (33, 8, 'تعديل العنوان الوطني'), (34, 8, 'طباعة إثبات العنوان الوطني'),
(35, 12, 'طلب إصدار وكالة إلكترونية'), (36, 12, 'الاستعلام عن الصكوك العقارية'), (37, 11, 'تحديث بيانات المؤمن عليه'), (38, 11, 'الاستعلام عن أهلية التأمين'),
(39, 16, 'حجز موعد فحص دوري'), (40, 16, 'الاستعلام عن نتيجة الفحص'), (41, 1, 'طلب شهادة إتمام بناء'), (42, 2, 'صرف دفعات دعم البناء الذاتي'),
(43, 2, 'الاستعلام عن أهلية الدعم السكني'), (44, 3, 'طلب نقل ملكية عداد كهرباء'), (45, 3, 'طلب إلغاء خدمة الكهرباء'), (46, 4, 'طلب نقل ملكية عداد مياه'),
(47, 4, 'طلب توصيل مياه مؤقت للمشاريع'), (48, 5, 'شطب سجل تجاري'), (49, 9, 'طلب تأشيرة زيارة عائلية'), (50, 9, 'تفعيل الهوية الرقمية (للزوار)'),
(51, 13, 'طلب السداد المبكر لقرض'), (52, 13, 'طلب تمديد فترة القرض'), (53, 1, 'طلب تجديد رخصة البناء'), (54, 1, 'طلب ترخيص لوحة دعائية'),
(55, 2, 'تقديم شكوى ضد مقاول'), (56, 2, 'تحديث بيانات الدخل الشهري'), (57, 3, 'طلب تركيب عداد إضافي'), (58, 3, 'الاعتراض على قيمة الفاتورة'),
(59, 4, 'طلب فحص جودة المياه'), (60, 4, 'الإبلاغ عن تسرب/هدر للمياه'), (61, 5, 'طلب تغيير الاسم التجاري'), (62, 5, 'تسجيل علامة تجارية'),
(63, 6, 'نقل خدمات عامل وافد'), (64, 6, 'تعديل مهنة عامل وافد'), (65, 6, 'إصدار شهادة سعودة/نطاقات'), (66, 7, 'طلب استرداد ضريبة القيمة المضافة'),
(67, 7, 'التسجيل في ضريبة السلع الانتقائية'), (68, 8, 'الاستعلام عن موقع بريدي (صندوق بريد)'), (69, 8, 'تسجيل العنوان المختصر (للمركبات)'), (70, 9, 'طلب تصريح الحج'),
(71, 9, 'الاستعلام عن حالة تصريح الحج'), (72, 10, 'الإبلاغ عن تغيب عامل وافد'), (73, 10, 'إصدار تأشيرة خروج وعودة متعددة'), (74, 11, 'تقديم شكوى على شركة تأمين'),
(75, 12, 'طلب حصر ورثة'), (76, 13, 'طلب تقييم عقاري جديد (لغرض التمويل)'), (77, 13, 'طلب إعادة جدولة القرض'),
(78, 14, 'طلب ترخيص لمعدات ومركبات السلامة'), (79, 14, 'تجديد ترخيص محطة وقود'),
(80, 15, 'الإبلاغ عن حادث مروري دون إصابات'), (81, 15, 'تجديد رخصة سير مركبة (استمارة)'),
(82, 16, 'طلب فحص دوري للمركبات الثقيلة'), (83, 16, 'حجز فحص مطور (للتصدير)'),
(84, 17, 'ترخيص المعدات الطبية الجديدة'), (85, 17, 'طلب تسجيل لقاح/تطعيم'),
(86, 13, 'طلب إيقاف مؤقت لأقساط القرض'), (87, 12, 'الاعتراض على حكم قضائي (عبر ناجز)'), (88, 1, 'طلب تغيير استخدام عقار (من سكني لتجاري)'), (89, 7, 'الاستعلام عن رقم تعريف ضريبي (TIN)');


-- 6. إدخال بيانات: الرحلات المعقدة (Complex_Journeys) - مدمج
INSERT INTO Complex_Journeys (journey_id, journey_name, search_keyword) VALUES
(1, 'بناء منزل جديد', 'بناء منزل'), (2, 'بدء نشاط تجاري فردي', 'بدء نشاط تجاري'),
(3, 'توظيف عامل وافد جديد', 'توظيف عامل وافد'), (4, 'بيع عقار مرهون للبنك', 'بيع عقار مرهون'),
(5, 'ترخيص منشأة صحية جديدة', 'إصدار ترخيص لمنشأة صحية'), (6, 'إتمام شراء مركبة مستعملة', 'شراء مركبة مستعملة'),
(7, 'تطوير عقار قديم إلى تجاري', 'تطوير عقار'), (8, 'إنهاء أعمال وتصفية شركة', 'تصفية شركة'),
(9, 'توظيف طبيب أو ممارس صحي وافد', 'توظيف طبيب'), (10, 'نقل ملكية عقار بتمويل جديد (للمشتري)', 'شراء عقار جديد بتمويل'),
(11, 'تجديد سجل شركة وتراخيصها الأساسية', 'تجديد تراخيص شركة'), (12, 'شراء مركبة مستعملة وتأمينها (للنقل)', 'شراء شاحنة مستعملة'),
(13, 'تسوية عقارية بعد حصر ورثة', 'بيع عقار ورثة'), (14, 'التوظيف في منشأة جديدة', 'توظيف أول عامل'),
(15, 'تعديل مهني وسكن عامل وافد', 'تغيير مهنة عامل'),
(16, 'طلب دعم سكني بتمويل عقاري (المتقدم)', 'تسهيلات دعم سكني'),
(17, 'الاستعداد والتقديم لموسم الحج', 'حجز تصريح حج'),
(18, 'الحصول على تمويل شخصي بضمان عقار (للمالك)', 'الحصول على قرض عقاري');


-- 7. إدخال بيانات: ربط الخدمات بالرحلات (Journey_Services) 
INSERT INTO Journey_Services (journey_id, service_id, service_order) VALUES
(1, 1, 1), (1, 2, 2), (1, 3, 3), (1, 4, 4),
(2, 5, 1), (2, 6, 2), (2, 7, 3), (2, 8, 4), (2, 9, 5),
(3, 10, 1), (3, 11, 2), (3, 12, 3), (3, 13, 4),
(4, 14, 1), (4, 15, 2), (4, 16, 3),
(5, 17, 1), (5, 18, 2), (5, 19, 3),
(6, 20, 1), (6, 21, 2), (6, 22, 3),
(7, 76, 1), (7, 53, 2), (7, 25, 3), (7, 29, 4), (7, 44, 5), (7, 9, 6), (7, 6, 7),
(8, 72, 1), (8, 74, 2), (8, 45, 3), (8, 48, 4), (8, 30, 5), (8, 33, 6),
(9, 17, 1), (9, 10, 2), (9, 11, 3), (9, 12, 4), (9, 23, 5), (9, 13, 6),
(10, 76, 1), (10, 51, 2), (10, 14, 3), (10, 15, 4), (10, 3, 5), (10, 4, 6),
(11, 25, 1), (11, 6, 2), (11, 30, 3), (11, 37, 4), (11, 31, 5), (11, 81, 6),
(12, 40, 1), (12, 21, 2), (12, 22, 3), (12, 81, 4), (12, 69, 5),
(13, 75, 1), (13, 16, 2), (13, 15, 3), (13, 45, 4), (13, 33, 5),
(14, 7, 1), (14, 21, 2), (14, 11, 3), (14, 10, 4), (14, 13, 5),
(15, 64, 1), (15, 63, 2), (15, 33, 3), (15, 37, 4),
(16, 43, 1), (16, 76, 2), (16, 52, 3), (16, 77, 4),
(17, 70, 1), (17, 71, 2), (17, 32, 3), (17, 85, 4),
(18, 76, 1), (18, 14, 2), (18, 52, 3), (18, 86, 4);


-- 8. إدخال بيانات: خطوات الخدمات (Steps) - مدمج
INSERT INTO Steps (service_id, step_order, step_description) VALUES
(1, 1, 'رفع طلب الترخيص عبر منصة بلدي.'), (1, 2, 'إرفاق المستندات الإلزامية المطلوبة (صك و مخططات).'), (1, 3, 'انتظار مراجعة البلدية والمكتب الهندسي.'),
(1, 4, 'سداد رسوم الرخصة عبر نظام سداد.'), (1, 5, 'إصدار الرخصة وتفعيلها إلكترونياً.'),
(2, 1, 'التحقق من أهلية الدعم السكني عبر سكني.'), (2, 2, 'توقيع عقد الدعم مع الجهة الممولة.'), (2, 3, 'الحصول على رخصة البناء (س1).'),
(2, 4, 'تقديم طلب الدعم وبدء الصرف بعد إنجاز مراحل البناء.'),
(3, 1, 'توفير رخصة بناء سارية.'), (3, 2, 'تقديم طلب الخدمة وتحديد الأحمال الكهربائية المطلوبة.'), (3, 3, 'إجراء الكشف الميداني من قِبل الشركة.'),
(3, 4, 'سداد الفواتير اللازمة لإيصال الخدمة.'),
(4, 1, 'تقديم طلب التوصيل وتحديد نقطة العقار.'), (4, 2, 'إرفاق صك الملكية أو المستندات البديلة.'), (4, 3, 'دفع الرسوم المقررة لتوصيل العدادات.'),
(5, 1, 'تسجيل الدخول على منصة وزارة التجارة.'), (5, 2, 'إدخال الاسم التجاري المقترح والتحقق من توافره.'), (5, 3, 'تأكيد الحجز وسداد الرسوم.'),
(6, 1, 'حجز اسم تجاري مسبقاً (س5).'), (6, 2, 'تحديد نوع النشاط ورأس مال الشركة.'), (6, 3, 'دفع الرسوم وإصدار السجل إلكترونياً.'),
(7, 1, 'الحصول على السجل التجاري (س6).'), (7, 2, 'تسجيل الدخول في قوى باستخدام بيانات أبشر.'), (7, 3, 'إضافة المنشأة باستخدام رقم السجل التجاري.'),
(8, 1, 'التحقق من تجاوز حد التسجيل الإلزامي للإيرادات.'), (8, 2, 'تقديم طلب التسجيل عبر بوابة ZATCA.'), (8, 3, 'تلقي شهادة التسجيل في VAT.'),
(9, 1, 'تحديد موقع المنشأة الجغرافي.'), (9, 2, 'تسجيل العنوان وربطه بالمنشأة (س6).'), (9, 3, 'طباعة إثبات العنوان الوطني.'),
(10, 1, 'تقديم طلب التأشيرة وتحديد المهنة المطلوبة.'), (10, 2, 'سداد رسوم التأشيرة.'), (10, 3, 'إصدار رقم التأشيرة الإلكتروني.'),
(11, 1, 'إدخال مسودة العقد في قوى.'), (11, 2, 'موافقة العامل الوافد على العقد عبر أبشر.'), (11, 3, 'توثيق العقد رسمياً.'),
(12, 1, 'اختيار شركة التأمين والدفع.'), (12, 2, 'إصدار وثيقة التأمين للمستفيدين (س13).'),
(13, 1, 'إتمام الفحص الطبي (عبر منصة وافد).'), (13, 2, 'الحصول على وثيقة تأمين طبي سارية (س12).'), (13, 3, 'سداد رسوم الإقامة.'),
(13, 4, 'إصدار الإقامة.'),
(14, 1, 'تقديم طلب فك الرهن للبنك بعد سداد كامل المبلغ.'), (14, 2, 'الحصول على وثيقة فك الرهن من البنك.'), (14, 3, 'توثيق فك الرهن إلكترونياً (ناجز).'),
(15, 1, 'اتفاق البائع والمشتري على شروط الإفراغ.'), (15, 2, 'دخول ناجز وتقديم طلب الإفراغ.'), (15, 3, 'توثيق عملية البيع إلكترونياً بعد التحقق من الصكوك.'),
(16, 1, 'تقديم طلب تحديث الصك عبر ناجز.'), (16, 2, 'إرفاق الصك القديم وبيانات العقار.'), (16, 3, 'استلام الصك المحدث برقم آلي موحد.'),
(17, 1, 'تحديد نوع المنشأة الصحية.'), (17, 2, 'توظيف مدير فني/طبي مرخص (س23).'), (17, 3, 'استيفاء شروط الموقع والتجهيزات.'),
(17, 4, 'تقديم طلب الترخيص وسداد الرسوم.'),
(18, 1, 'الحصول على رخصة البناء (س1).'), (18, 2, 'الحصول على شهادة السلامة (س19).'), (18, 3, 'تقديم طلب الرخصة التشغيلية.'), (18, 4, 'إصدار رخصة التشغيل.'),
(19, 1, 'تطبيق اشتراطات السلامة والوقاية من الحريق.'), (19, 2, 'تقديم طلب فحص ميداني عبر المنصة.'), (19, 3, 'سداد الرسوم واستلام الشهادة.'),
(20, 1, 'حجز موعد فحص (س39).'), (20, 2, 'سداد رسوم الفحص.'), (20, 3, 'إحضار المركبة للفحص والحصول على الشهادة.'),
(21, 1, 'اختيار شركة التأمين المناسبة للمركبة.'), (21, 2, 'إدخال بيانات المركبة والمشتري.'), (21, 3, 'سداد مبلغ التأمين.'), (21, 4, 'إصدار وثيقة التأمين.'),
(22, 1, 'توفير فحص فني سارٍ (س20).'), (22, 2, 'توفير وثيقة تأمين سارية (س21).'), (22, 3, 'اتفاق البائع والمشتري على المبلغ.'),
(22, 4, 'دخول أبشر وتقديم طلب نقل الملكية والموافقة.'),
(23, 1, 'التحقق من استيفاء ساعات التعليم الطبي المستمر (CME).'), (23, 2, 'سداد رسوم التجديد.'), (23, 3, 'تقديم طلب التجديد عبر منصة صحي.'),
(25, 1, 'إجراء صيانة شاملة لأنظمة الإطفاء والسلامة.'), (25, 2, 'رفع تقارير الصيانة للجهات المعتمدة.'), (25, 3, 'تقديم طلب التجديد وإرفاق التقارير (س1025).'),
(31, 1, 'توفير وثيقة تأمين طبي سارية (س12).'), (31, 2, 'سداد رسوم التجديد وغرامات التأخير (إن وجدت).'), (31, 3, 'إصدار/تجديد الإقامة عبر أبشر أعمال.'),
(41, 1, 'الانتهاء من أعمال البناء بالكامل.'), (41, 2, 'الحصول على تقرير إنجاز البناء وطلب فحص ميداني.'), (41, 3, 'إصدار الشهادة إلكترونياً.'),
(42, 1, 'تقديم تقرير إنجاز البناء (س2011) للمرحلة المكتملة.'), (42, 2, 'طلب فحص ميداني من مقيّم سكني.'), (42, 3, 'صرف الدفعة المستحقة.'),
(44, 1, 'سداد جميع الفواتير المستحقة على العداد.'), (44, 2, 'تقديم طلب نقل ملكية العداد عبر منصة الشركة.'), (44, 3, 'إرفاق صك الملكية الجديد أو عقد الإيجار.'),
(48, 1, 'إلغاء جميع التراخيص الفرعية والعمالة التابعة.'), (48, 2, 'تقديم طلب شطب السجل التجاري.'), (48, 3, 'دفع الرسوم المترتبة على الشطب.'),
(49, 1, 'تقديم الطلب وتحديد عدد أفراد العائلة.'), (49, 2, 'سداد الرسوم عبر سداد.'), (49, 3, 'إصدار رقم التأشيرة الإلكتروني.'),
(63, 1, 'موافقة العامل على طلب النقل.'), (63, 2, 'موافقة صاحب العمل الحالي.'), (63, 3, 'تقديم نموذج نقل الكفالة (س4003).'), (63, 4, 'إصدار العقد الجديد في قوى.'),
(70, 1, 'التسجيل في أحد البرامج المعتمدة.'), (70, 2, 'التحقق من حالة اللياقة الصحية.'), (70, 3, 'سداد قيمة الباقة.'), (70, 4, 'إصدار تصريح الحج.'),
(75, 1, 'تسجيل واقعة الوفاة في الأحوال المدنية.'), (75, 2, 'تقديم طلب حصر الورثة عبر ناجز.'), (75, 3, 'إدخال بيانات المتوفى والورثة.'), (75, 4, 'إصدار وثيقة حصر الورثة.'),
(76, 1, 'تقديم طلب التقييم العقاري عبر جهة التمويل.'), (76, 2, 'تحديد موقع العقار وتقدير قيمته الأولية.'), (76, 3, 'إجراء التقييم الميداني وإصدار التقرير النهائي.'),
(81, 1, 'سداد المخالفات المرورية إن وجدت.'), (81, 2, 'توفير فحص دوري سارٍ (س20).'), (81, 3, 'سداد رسوم التجديد.'), (81, 4, 'إصدار الرخصة إلكترونياً.');


-- 9. إدخال بيانات: متطلبات الخدمات (Service_Requirements) 
INSERT INTO Service_Requirements (step_id, req_def_id, is_required) VALUES
-- Service ID 1: رخصة بناء (Step ID 1-5)
(1, 1001, TRUE), (2, 1003, TRUE), (2, 1004, TRUE), (3, 1002, FALSE), (4, 1029, TRUE),
-- Service ID 2: طلب دعم البناء الذاتي (Step ID 6-9)
(6, 2012, TRUE), (7, 1001, TRUE), (8, 1005, TRUE),
-- Service ID 3: طلب توصيل خدمة الكهرباء (Step ID 10-13)
(10, 1005, TRUE), (11, 1007, TRUE), (13, 1029, TRUE),
-- Service ID 4: طلب توصيل خدمات المياه والصرف الصحي (Step ID 14-16)
(14, 1006, TRUE), (15, 1003, TRUE), (15, 1008, FALSE), (16, 1029, TRUE),
-- Service ID 5: حجز الاسم التجاري (Step ID 17-19)
(17, 1009, TRUE), (19, 1029, TRUE),
-- Service ID 6: إصدار السجل التجاري (Step ID 20-22)
(20, 2016, TRUE), (20, 1010, TRUE),
-- Service ID 7: تسجيل المنشأة في منصة قوى (Step ID 23-25)
(25, 1011, TRUE),
-- Service ID 10: إصدار تأشيرة عمل (Step ID 26-28)
(26, 1011, TRUE), (27, 1029, TRUE), (27, 1012, FALSE),
-- Service ID 11: توثيق عقد العمل (Step ID 29-31)
(29, 1013, TRUE),
-- Service ID 12: إصدار وثيقة تأمين طبي سارية (Step ID 32-33)
(33, 1015, TRUE),
-- Service ID 13: إصدار الإقامة (Step ID 34-37)
(34, 2003, TRUE), (35, 1016, TRUE), (36, 1029, TRUE),
-- Service ID 14: طلب فك الرهن (Step ID 38-40)
(38, 1017, TRUE), (39, 1019, TRUE),
-- Service ID 15: طلب الإفراغ العقاري (Step ID 41-43)
(41, 1017, TRUE), (41, 1020, TRUE),
-- Service ID 17: ترخيص المنشأة الطبية (Step ID 44-47)
(44, 1021, TRUE), (45, 1022, TRUE), (45, 1023, TRUE), (46, 3007, FALSE),
-- Service ID 19: إصدار شهادة السلامة (Step ID 48-50)
(48, 1005, TRUE), (49, 3012, FALSE), (50, 1029, TRUE),
-- Service ID 20: إجراء الفحص الفني الدوري (Step ID 51-53)
(51, 1026, TRUE), (52, 1029, TRUE),
-- Service ID 21: شراء وثيقة تأمين سارٍ (Step ID 54-57)
(54, 1026, TRUE), (55, 1028, TRUE),
-- Service ID 22: نقل ملكية المركبة إلكترونياً (Step ID 58-61)
(58, 1027, TRUE), (58, 3006, TRUE), (59, 2005, FALSE), (61, 1026, TRUE),
-- Service ID 23: تجديد ترخيص الممارس الصحي (Step ID 62-64)
(62, 2010, TRUE), (63, 2008, TRUE),
-- Service ID 25: تجديد رخصة السلامة للمنشآت (Step ID 65-67)
(65, 1025, TRUE), (66, 1024, TRUE),
-- Service ID 31: تجديد إقامة عامل وافد (Step ID 68-70)
(68, 1016, TRUE), (69, 2008, TRUE),
-- Service ID 41: طلب شهادة إتمام بناء (Step ID 71-73)
(71, 2011, TRUE), (71, 2019, TRUE),
-- Service ID 42: صرف دفعات دعم البناء الذاتي (Step ID 74-76)
(74, 2011, TRUE), (76, 4002, TRUE),
-- Service ID 44: طلب نقل ملكية عداد كهرباء (Step ID 77-79)
(77, 2014, TRUE), (78, 2013, TRUE), (79, 1017, TRUE),
-- Service ID 48: شطب سجل تجاري (Step ID 80-82)
(80, 3001, TRUE),
-- Service ID 49: طلب تأشيرة زيارة عائلية (Step ID 83-85)
(83, 2017, TRUE), (84, 1029, TRUE),
-- Service ID 63: نقل خدمات عامل وافد (Step ID 86-89)
(88, 4003, TRUE), (89, 3001, FALSE),
-- Service ID 70: طلب تصريح الحج (Step ID 90-93)
(90, 3009, TRUE), (91, 1001, TRUE),
-- Service ID 75: طلب حصر ورثة (Step ID 94-97)
(94, 4004, TRUE),
-- Service ID 76: طلب تقييم عقاري جديد (Step ID 98-100)
(98, 1017, TRUE), (98, 4001, FALSE),
-- Service ID 81: تجديد رخصة سير مركبة (Step ID 101-104)
(101, 2005, TRUE), (102, 1027, TRUE), (103, 1029, TRUE);


-- 10. الاستعلام الشامل الموحد (Unified Service and Requirement Detailed View)
SELECT
    -- تفاصيل الرحلة المعقدة (قد تكون NULL للخدمات المستقلة)
    J.journey_name AS 'الرحلة_المعقدة',
    J.search_keyword AS 'كلمة_البحث_للرحلة',
    JS.service_order AS 'ترتيب_الخدمة_في_الرحلة',

    -- تفاصيل الخدمة البسيطة
    S.service_name AS 'اسم_الخدمة_البسيطة',
    E.entity_name AS 'الجهة_المقدمة_للخدمة',
    E.entity_url AS 'رابط_المنصة',

    -- تفاصيل الخطوات
    ST.step_order AS 'ترتيب_الخطوة',
    ST.step_description AS 'وصف_الخطوة_التنفيذية',

    -- تفاصيل المتطلب
    RD.req_display_name_ar AS 'المتطلب_المحدد',
    RD.source_type AS 'مصدر_البيانات_المتوقع',
    RD.data_type AS 'نوع_البيانات',
    SR.is_required AS 'هل_هو_إلزامي'

FROM
    Services S
JOIN Entities E ON S.entity_id = E.entity_id
LEFT JOIN Journey_Services JS ON S.service_id = JS.service_id
LEFT JOIN Complex_Journeys J ON JS.journey_id = J.journey_id
LEFT JOIN Steps ST ON S.service_id = ST.service_id
LEFT JOIN Service_Requirements SR ON ST.step_id = SR.step_id
LEFT JOIN Requirement_Definition RD ON SR.req_def_id = RD.req_def_id

ORDER BY
    S.service_id,
    JS.service_order,
    ST.step_order,
    RD.req_display_name_ar;
